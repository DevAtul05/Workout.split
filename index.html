<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Nether Dino Game</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      background: black;
    }
    canvas {
      border: 2px solid #222;
      border-radius: 10px;
      background: #000;
    }
  </style>
</head>

<body>
<canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  function resizeCanvas() {
    canvas.width = window.innerWidth * 0.95;
    canvas.height = window.innerHeight * 0.55;
    if (canvas.height < 260) canvas.height = 260;
  }
  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  // =====================
  // LOAD ASSETS
  // =====================
  const dinoImg = new Image();
  dinoImg.src = "dino.png";

  const flameImg = new Image();
  flameImg.src = "fire.gif"; // obstacle

  // =====================
  // VARIABLES
  // =====================
  let groundY = canvas.height - 60;

  let dino = {
    x: 60,
    y: groundY - 80,
    w: 70,
    h: 80,
    vy: 0,
    gravity: 0.8,
    jumpForce: -14,
    grounded: true
  };

  let obstacles = [];
  let score = 0, highScore = 0;
  let speed = 5;
  let started = false, gameOver = false;
  let obstacleCooldown = 0;

  // =====================
  // COLLISION
  // =====================
  const rectsCollide = (a, b) =>
    a.x + a.w * 0.6 > b.x &&
    a.x + a.w * 0.4 < b.x + b.w &&
    a.y + a.h * 0.8 > b.y &&
    a.y + a.h * 0.2 < b.y + b.h;

  // =====================
  // CONTROLS
  // =====================
  function jump() {
    if (!started) {
      started = true;
      loop();
      return;
    }
    if (gameOver) { resetGame(); return; }

    if (dino.grounded) {
      dino.vy = dino.jumpForce;
      dino.grounded = false;
    }
  }

  window.addEventListener("keydown", e => {
    if (["Space", "ArrowUp"].includes(e.code)) jump();
  });
  window.addEventListener("touchstart", jump);
  window.addEventListener("mousedown", jump);

  function resetGame() {
    gameOver = false;
    started = false;
    score = 0;
    speed = 5;
    obstacles = [];
    dino.y = groundY - dino.h;
    dino.vy = 0;
    obstacleCooldown = 0;
    draw();
  }

  // =====================
  // MAIN LOOP
  // =====================
  function loop() {
    update();
    draw();
    if (!gameOver) requestAnimationFrame(loop);
  }

  function update() {
    dino.vy += dino.gravity;
    dino.y += dino.vy;

    if (dino.y >= groundY - dino.h) {
      dino.y = groundY - dino.h;
      dino.vy = 0;
      dino.grounded = true;
    }

    // Obstacles
    if (obstacleCooldown <= 0 && Math.random() < 0.02) {
      obstacles.push({
        x: canvas.width,
        y: groundY - 70,
        w: 70,
        h: 70
      });
      obstacleCooldown = 110 + Math.random() * 100;
    } else obstacleCooldown--;

    obstacles.forEach(o => o.x -= speed);
    obstacles = obstacles.filter(o => o.x + o.w > 0);

    // Collision
    for (let o of obstacles) {
      if (rectsCollide(dino, o)) {
        gameOver = true;
        if (score > highScore) highScore = score;
      }
    }

    if (!gameOver) {
      score += 0.05;
      if (speed < 9) speed += 0.0004;
    }
  }

  // =============================
  // DRAW NETHER BACKGROUND
  // =============================
  function drawNetherSky() {
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, "#2b0000");
    grad.addColorStop(0.4, "#3c0000");
    grad.addColorStop(1, "#1a0000");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // =============================
  // RED MOON (FIXED VERSION)
  // =============================
  function drawRedMoon() {
    const w = canvas.width;
    const t = performance.now() * 0.001;

    const cx = w * 0.78;
    const cy = 90;
    const moonR = 52 + Math.sin(t * 1.2) * 3;

    // glow
    const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, moonR * 3);
    g.addColorStop(0, "rgba(255,80,80,0.95)");
    g.addColorStop(0.5, "rgba(180,20,20,0.22)");
    g.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(cx, cy, moonR * 3, 0, Math.PI * 2);
    ctx.fill();

    // moon
    ctx.beginPath();
    ctx.arc(cx, cy, moonR, 0, Math.PI * 2);
    ctx.fillStyle = "#ff3333";
    ctx.fill();
  }

  // =============================
  // VOLCANOES + LAVA ANIMATION
  // =============================
  let lavaWave = 0;

  function drawVolcanoes() {
    lavaWave += 0.07;

    function drawVolcano(xBase) {
      const baseY = groundY;
      ctx.fillStyle = "#330000";
      ctx.beginPath();
      ctx.moveTo(xBase, baseY);
      ctx.lineTo(xBase + 90, baseY - 140);
      ctx.lineTo(xBase + 180, baseY);
      ctx.fill();

      // Lava glow
      ctx.globalAlpha = 0.7;
      ctx.fillStyle = "rgb(" + (200 + Math.sin(lavaWave) * 40) + ",40,0)";
      ctx.fillRect(xBase + 70, baseY - 140, 40, 25);
      ctx.globalAlpha = 1;
    }

    for (let x = -200; x < canvas.width + 200; x += 260) {
      drawVolcano(x);
    }
  }

  // =============================
  // DRAW EVERYTHING
  // =============================
  function draw() {
    groundY = canvas.height - 60;

    drawNetherSky();
    drawRedMoon();
    drawVolcanoes();

    // Ground
    ctx.fillStyle = "#2b0000";
    ctx.fillRect(0, groundY, canvas.width, canvas.height-groundY);

    // Obstacles
    obstacles.forEach(o => {
      if (flameImg.complete)
        ctx.drawImage(flameImg, o.x, o.y, o.w, o.h);
      else {
        ctx.fillStyle = "red";
        ctx.fillRect(o.x, o.y, o.w, o.h);
      }
    });

    // Dino
    if (dinoImg.complete)
      ctx.drawImage(dinoImg, dino.x, dino.y, dino.w, dino.h);
    else {
      ctx.fillStyle = "#fff";
      ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
    }

    // TEXT
    ctx.fillStyle = "#fff";
    ctx.font = "26px monospace";
    ctx.fillText("Score: " + Math.floor(score), 20, 40);
    ctx.fillText("High: " + Math.floor(highScore), canvas.width - 160, 40);

    if (gameOver) {
      ctx.fillStyle = "rgba(0,0,0,0.6)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#ff4444";
      ctx.font = "40px monospace";
      ctx.fillText("GAME OVER", canvas.width / 2 - 130, canvas.height / 2);
      ctx.font = "20px monospace";
      ctx.fillText("Tap to Restart", canvas.width / 2 - 80, canvas.height / 2 + 40);
    }

    if (!started && !gameOver) {
      ctx.fillStyle = "#ffffffaa";
      ctx.font = "26px monospace";
      ctx.fillText("Tap or Press Space to Start",
                   canvas.width/2 - 170, canvas.height/2);
    }
  }

  draw();
})();
</script>

</body>
</html>
